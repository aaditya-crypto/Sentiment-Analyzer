<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>SentimentAnalyserX | Dashboard</title>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css'>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='userpage.css') }}">
</head>
<body>
<!-- partial:index.partial.html -->
<div class="wrapper">
  <div id="content">
    <h1><b>Hello </b><span style="color: rgb(235, 89, 89);"><b>{{name}}</b></span> &#128075;</h1>

    <div class="container-fluid">
      <div class="main-content">
        <div class="main-header">
          <h2>ğŸ”“ "Unlock Your Desires: <span style="color: rgb(21, 221, 228);"><b>Let Us Know What You Wish to Explore Today!</b></span>" </h2>
        </div>
        <div class="card-group">
          <div class="card">
            <!-- Add target="_blank" to open in a new tab -->
            <a href="https://www.google.com/" target="_blank">
              <button class="analyse-button text-button">ğŸ“ Unleash the Emotion Power of Text ğŸ“</button>
            </a>
          </div>
          <div class="card">
            <!-- Add target="_blank" to open in a new tab -->
            <a href="https://www.google.com/" target="_blank">
              <button class="analyse-button file-button">ğŸ“‚ Explore Emotions through Files ğŸ“‚</button>
            </a>
          </div>
        </div>
        <div id="recent-trends">
          <h2>ğŸ—“ï¸ "Your Journey with Us: <span style="color: rgb(211, 80, 223);"><b>A Timeline of Your Website Engagements !</b></span>"</h2>
        </div>
        <div class="card-group">
          <div class="card">
            <h3>ğŸ“</h3>
            <h3><b>Text Analysed</b></h3>
            <h3 id="textCount">Loading...</h3>
          </div>
          <div class="card">
            <h3>ğŸ“‚</h3>
            <h3><b>File Analysed</b></h3>
            <h3 id="fileCount">Loading...</h3>
          </div>
        </div>
        <!-- <h2>ğŸ“‹ "Analytical Insights: <span style="color: rgb(78, 173, 242);"><b>Summary of Analysed Files !</b></span>"</h2> -->
        <div id="table-section">
          <table class="table">
            <thead>
              <tr>
                <th>FILE NAME</th>
                <th>FILE TYPE</th>
                <th>ANALYSED ON</th>
                <th>OVERALL SENTIMENT</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>             
      </div>
    </div>
  </div>
  <a href="/logout" class="logout-button"><b>Logout</b></a>
<!-- partial -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/highcharts/6.2.0/highcharts.js'></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      // Make an AJAX call to the API for card data
      $.ajax({
        url: "http://127.0.0.1:5000/userhistorycard",
        type: "GET",
        dataType: "json",
        success: function(data) {
          // Update the HTML content of the card elements with the received data
          $("#textCount").text(data.Text);
          $("#fileCount").text(data.File);
        },
        error: function(error) {
          console.error("Error fetching card data from API:", error);
        }
      });
  
      // Make an AJAX call to the API for table data
      $.ajax({
        url: "http://127.0.0.1:5000/userhistorytable",
        type: "GET",
        dataType: "json",
        success: function(data) {
          var tableData = data.data;
  
          if (tableData && tableData.length > 0) {
            var tableBody = $("#table-section tbody");
  
            // Loop through the data and create table rows
            tableData.forEach(function(fileData) {
              var row = $("<tr></tr>");
  
              fileData.forEach(function(item, index) {
                // Check if it's the last column ("OVERALL SENTIMENT")
                if (index === fileData.length - 1) {
                  var colorClass = ""; // Default color class is empty (white background)
                  var sentimentText = ""; // Default sentiment text is empty
  
                  // Set the color class and sentiment text based on the value
                  if (item === "Positive") {
                    colorClass = "positive-bg";
                    sentimentText = "Positive";
                  } else if (item === "Negative") {
                    colorClass = "negative-bg";
                    sentimentText = "Negative";
                  } else if (item === "Neutral") {
                    colorClass = "neutral-bg";
                    sentimentText = "Neutral";
                  }
  
                  // Append the table cell with the box and text
                  row.append('<td><div class="sentiment-box ' + colorClass + '">' + sentimentText + '</div></td>');
                } else {
                  // For other columns, just append the data without any changes
                  row.append("<td>" + item + "</td>");
                }
              });
  
              tableBody.append(row);
            });
          }
        },
        error: function(error) {
          console.error("Error fetching table data from API:", error);
        }
      });
    });
  </script>
  </body>
  </html>
  